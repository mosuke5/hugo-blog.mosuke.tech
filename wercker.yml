box: ruby:2.3
build:
  steps:
    - install-packages:
        packages: git optipng libjpeg-progs yui-compressor
  #  - script:
  #      name: download theme
  #      code: |
  #          $(git clone https://github.com/dplesca/purehugo ./themes/purehugo)
  #  - arjen/hugo-build:
  #      version: "0.27.1"
  #      theme: purehugo
  #      flags: --buildDrafts=false
  #  - script:
  #    name: optimize image size
  #    code: |
  #      sh ./scripts/optimize_image.sh
  #after-steps:
  #  - slack-notifier:
  #    channel: $SLACK_CHANNEL
  #    url: $SLACK_URL
  #    username: wercker_bot

deploy:
  steps:
    - install-packages:
        packages: git ssh-client curl
    - leipert/git-push:
        gh_oauth: $GIT_TOKEN
        repo: mosuke5-lab/mosuke5-lab.github.io
        branch: master
        basedir: public
        gh_pages_domain: blog.mosuke.tech
    - script:
      name: delete cloudflare cache in top page
      code: |
        sh ./scripts/delete_top_page_cache.sh ${CF_ZONE_ID} ${CF_EMAIL} ${CF_KEY}
  after-steps:
    - slack-notifier:
      channel: $SLACK_CHANNEL
      url: $SLACK_URL
      username: wercker_bot
update-gillsearch:
  steps:
    - install-packages:
        packages: git cmake
    - script:
      name: install bundler
      code: |
        gem install bundler
    - script:
      name: clone repository
      code: |
        git clone https://github.com/mosuke5/hugo-entry-to-elasticsearch-json.git
    - script:
      name: bundle install
      code: |
        cd hugo-entry-to-elasticsearch-json && bundle install
    - script:
      name: create entries file
      code: |
        LANG=C.UTF-8 && cd hugo-entry-to-elasticsearch-json && sh build.sh https://github.com/mosuke5/hugo-blog.mosuke.tech.git