+++
Categories = ["SSH", "インフラ", "ポートフォワード"]
Description = "サービスの管理画面へSSHのローカルポート越しにhttpsで接続したい場面があります。その際の接続方法の注意点について書きました。接続するプロトコルの確認が重要です。"
Tags = ["tech"]
date = "2015-02-11T17:21:00+09:00"
title = "SSHポートフォワードを通してhttps接続をするときの注意点"
author = "mosuke5"
archive = ["2015"]
draft = false
+++

<body>
<p>SSHローカルフォワードを使いこなしてますか？SSHを制するものはインフラを制するとも言われています。最近良く使っているのですが、ローカルポートフォワードでhttps接続をする際に間違えやすいポイントがあるので紹介します。</p>

下記は、以前に書いたSSHのローカルポートフォワードに関する記事です。まず基本的な概念や使い方を知りたい方は書きを参照してください。
<div class="iframely-embed"><div class="iframely-responsive" style="height: 140px; padding-bottom: 0;"><a href="https://blog.mosuke.tech/entry/2014/12/31/170545/" data-iframely-url="//cdn.iframe.ly/wDM0LAq"></a></div></div><script async src="//cdn.iframe.ly/embed.js" charset="utf-8"></script>
<!--more-->

<h2>1. やりたいこと</h2>

<p>httpsでサービスを提供しているサーバへ、SSHローカルポートフォワーディングを使って接続する。<br>
該当のサーバへは、ネットワーク上、直接疎通性がないためにポートフォワーディングする必要がある。</p>

具体的なユースケースだと、KubernetesやKibanaのダッシュボード(管理画面)などインターネットにそのまま公開していないが、接続にhttpsを接続に要求しており、SSH越しで接続したいなどがある。

<h2>2. 行ったこと</h2>
<p>httpsでしか接続ができないので、ローカル端末のポート5000を接続したいサーバのポート443にフォワードすれば問題ないと思い、
下記のようにssh接続をしたあと、ブラウザから接続を行った。</p>

```
// 対象のサーバへローカルポートフォワードのため接続する
$ ssh -L5000:web-host:443 user@ssh-host 
```

<p>※web-host: 今回httpsで接続したサーバ<br>
※ssh-host: ssh接続先サーバ</p>

<p>これでローカルフォワーディングの設定は終わったので、ブラウザから以下に接続すれば接続できると考えていた。しかし実際は接続することができなかった。それはなぜでしょうか？</p>

```
http://localhost:5000 
```

<h2>3. 何が間違いだったか</h2>

<p>正しくは以下のようにhttpsプロトコルで接続をしなければいけない。http<b><span style="color: #ff0000">s</span></b>が必要ということだ。</p>

```
https://localhost:5000 
```

<p>よく考えればアタリマエのこと。<br>
URLのはじめの&lt;http(s)&gt;の部分は<b>プロトコル</b>で最後の&lt;:5000&gt;の部分は<b>ポート番号</b>。<br>
<u><b><a class="keyword" href="http://d.hatena.ne.jp/keyword/https">https</a>は443のポートを一般的に使うが、ポート443が<a class="keyword" href="http://d.hatena.ne.jp/keyword/https">https</a>というわけではない。</b></u></p>

<p>あたりまえのことだし知っていることなんだけど、見落としがちかもしれない。</p>

<h2>4. まとめ</h2>
<p>非常に単純なことではあるのですが間違えやすいポイントかと思います。ローカルポートフォワードの接続先で443ポートを指定したので感覚的にhttpsにしていると思いがちです。実際に接続するプロトコルがなにか、改めて見直してみるとこういったミスは軽減できるし、非常に重要なことです。</p>
</body>
