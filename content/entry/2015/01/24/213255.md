+++
Categories = ["docker", "インフラ"]
Description = " dockerの一般的な利用の仕方ではあまり想定されないケースかもしれないが、 特定のユーザでログインした状態のコンテナを作りたいという場面に遭遇した。  &lt;やりたいこと&gt;   特定のユーザでログインした状態のシェルを提供するこ"
Tags = ["tech"]
date = "2015-01-24T21:32:00+09:00"
title = "dockerで特定ユーザでログインした状態のシェル環境を提供する"
author = "mosuke5"
archive = ["2015"]
draft = false
+++

<body>
<p>dockerの一般的な利用の仕方ではあまり想定されないケースかもしれないが、<br>
特定のユーザでログインした状態のコンテナを作りたいという場面に遭遇した。</p>

<h2>&lt;やりたいこと&gt;</h2>

<ul>
<li>特定のユーザでログインした状態のシェルを提供すること</li>
<li>その際、ユーザの.<a class="keyword" href="http://d.hatena.ne.jp/keyword/bash">bash</a>_profile（あるいあは.bashrc）を読み込んだ状態であること

<ul>
<li>.<a class="keyword" href="http://d.hatena.ne.jp/keyword/bash">bash</a>_profileに記載したPATHやaliasを使いたい</li>
<li>ユーザのログインシェルを利用したい（カスタマイズされたシェルとか）</li>
</ul>
</li>
</ul>


<p>docker runに-uオプションがあるし、これで余裕！と思った。</p>

<pre class="code" data-lang="" data-unlink> [host] $ sudo docker run -u=user_name -i -t image_name /bin/bash </pre>


<p>しかし…以下を確認してみると…</p>

<pre class="code" data-lang="" data-unlink> [docker] $ pwd
[docker] $ echo $PATH
[docker] $ alias
 </pre>


<p>ディレクトリは "/" だし、PATHも通ってない。<br>
どうやら.<a class="keyword" href="http://d.hatena.ne.jp/keyword/bash">bash</a>_profileなどは読んでいないようだ。普通にログインした状態とは違う。</p>

<p>dockerで-uでユーザを指定し場合、指定したuserでコマンドを実行するが、<br>
サーバにユーザでログインしてからコマンドを実行するわけではないらしい。</p>

<p>ディレクトリはどうやら-wオプションで解決できるようだが…</p>

<pre class="code" data-lang="" data-unlink> [host] $ sudo docker run -u=user_name -w /home/user_name -i -t image_name /bin/bash </pre>




<pre class="code" data-lang="" data-unlink> [docker] $ pwd
/home/user_name </pre>


<p>ディレクトリはおっけーだが、<br .>
当然ながら依然として.<a class="keyword" href="http://d.hatena.ne.jp/keyword/bash">bash</a>_profileはダメ。</p>

<p>そこでふと思いついた。-uも-wもいらない。<br>
<b>あの手</b>があるではないか…！！</p>

<pre class="code" data-lang="" data-unlink> [host] $ sudo docker run -i -t image_name su - username </pre>


<p>suでスイッチユーザすれば.<a class="keyword" href="http://d.hatena.ne.jp/keyword/bash">bash</a>_profileもホームディレクトリも全部解決だ！！</p>
</body>
