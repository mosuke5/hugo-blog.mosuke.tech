+++
Categories = ["Arduino"]
Description = " Ethernetシールドを使ってネットワークへ繋げる。 とりあえずは、スモールステップでPCとの1対1の通信。       PCとの1対1通信      構成図   Arduinoソースコード  #include &lt;SPI.h&gt"
Tags = ["tech"]
date = "2014-09-13T11:15:00+09:00"
title = "【Ethernetシールド】Arduinoをネットワークへ繋げる(1)"
author = "mosuke5"
archive = ["2014"]
draft = false
+++

<body>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Ethernet">Ethernet</a>シールドを使ってネットワークへ繋げる。<br>
とりあえずは、スモールステップでPCとの1対1の通信。</p>

<div class="section">
    <h4>PCとの1対1通信</h4>
    <p>構成図<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/m/mosuke5/20140907/20140907231747.png" alt="f:id:mosuke5:20140907231747p:plain" title="f:id:mosuke5:20140907231747p:plain" class="hatena-fotolife" itemprop="image"></span></p>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Arduino">Arduino</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a></p>

```c
#include <SPI.h>
#include <Ethernet.h>

byte MAC[] = {0x90,0xA2,0xDA,0x0F,0x8B,0xA2};
byte IP[]  = {192,168,11,3};

void setup()
{
  Ethernet.begin(MAC,IP);
}

void loop()
{
}
```

<p>疎通確認</p>
<pre class="code" data-lang="" data-unlink>
% ping 192.168.100.3
PING 192.168.100.3 (192.168.100.3): 56 data bytes
Request timeout for icmp_seq 0
64 bytes from 192.168.100.3: icmp_seq=1 ttl=128 time=0.576 ms
64 bytes from 192.168.100.3: icmp_seq=2 ttl=128 time=0.425 ms
64 bytes from 192.168.100.3: icmp_seq=3 ttl=128 time=0.302 ms 
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Ping">Ping</a>確認ヨシ!!</p>
<p>一応<a class="keyword" href="http://d.hatena.ne.jp/keyword/ARP">ARP</a>テーブルを見ておく。</p>
<pre class="code" data-lang="" data-unlink>
% arp -a
? (192.168.100.3) at 90:a2:da:f:8b:a2 on en4 ifscope [ethernet]
? (192.168.100.255) at ff:ff:ff:ff:ff:ff on en4 ifscope [ethernet] 
</pre>
<p>マックアドレスの取得もヨシ!!</p>

</div>
<div class="section">
    <h4>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/DHCP">DHCP</a>を使って家内LAN接続</h4>
    <p>実運用では<a class="keyword" href="http://d.hatena.ne.jp/keyword/DHCP">DHCP</a>を利用することが圧倒的に多いと思うが、こちらもとても簡単。</p>
<p>構成図<br>
<span itemscope itemtype="http://schema.org/Photograph"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/m/mosuke5/20140913/20140913110038.png" alt="f:id:mosuke5:20140913110038p:plain" title="f:id:mosuke5:20140913110038p:plain" class="hatena-fotolife" itemprop="image"></span></p>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%CC%B5%C0%FELAN">無線LAN</a>ルータから有線LANケーブルを伸ばし<a class="keyword" href="http://d.hatena.ne.jp/keyword/Arduino">Arduino</a>に結線。<br>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/DHCP">DHCP</a>による<a class="keyword" href="http://d.hatena.ne.jp/keyword/IP%A5%A2%A5%C9%A5%EC%A5%B9">IPアドレス</a>の取得はとても容易で以下のようにマックアドレスを指定するのみ。</p>
<pre class="code" data-lang="" data-unlink> Ethernet.begin(mac) 
</pre>
<p>以下は<a class="keyword" href="http://d.hatena.ne.jp/keyword/Arduino">Arduino</a>公式サイトに則って実施したもの。<br>
<a href="http://arduino.cc/en/Tutorial/DhcpAddressPrinter">Arduino - DhcpAddressPrinter</a><br>
</p>

```c
#include <SPI.h>
#include <Ethernet.h>

//Mac Address Static
byte mac[] = {0x90,0xA2,0xDA,0x0F,0x8B,0xA2};

void setup()
{
  // Open serial communications and wait for port to open:
  Serial.begin(9600);

  // start the Ethernet connection:
  if (Ethernet.begin(mac) == 0) {
    Serial.println("Failed to configure Ethernet using DHCP");
    // no point in carrying on, so do nothing forevermore:
    for(;;)
      ;
      
  }
  // print your local IP address:
  Serial.print("My IP address: ");
  for (byte thisByte = 0; thisByte < 4; thisByte++) {
    // print the value of each byte of the IP address:
    Serial.print(Ethernet.localIP()[thisByte], DEC);
    Serial.print("."); 
  }
  Serial.println();
}

void loop()
{
  Serial.println("abc");
  delay(3000);
}
```

<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Arduino">Arduino</a>に<a class="keyword" href="http://d.hatena.ne.jp/keyword/IP%A5%A2%A5%C9%A5%EC%A5%B9">IPアドレス</a>が割り当てられたかどうか確認するには、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CC%B5%C0%FELAN">無線LAN</a>ルータにアクセスし、マックアドレスと<a class="keyword" href="http://d.hatena.ne.jp/keyword/IP%A5%A2%A5%C9%A5%EC%A5%B9">IPアドレス</a>のヒモ付のテーブルをみればよい。</p>

</div>
</body>
